import sys, os
curr_path = os.path.dirname(__file__)
parent_path = os.path.dirname(curr_path)
sys.path.append(parent_path)  # add current terminal path to sys.path
sys.path.append(curr_path)  # add current terminal path to sys.path
import random
from Action import *
from loguru import logger as logging
from defination import Host_info, Action_Class



class Exploit():
    def __init__(self,
                 target_info: Host_info,
                 exp: Action_Class,
                 env_data:dict=None
                ):
        
        self.target_ip = target_info.ip
        self.target_info = target_info
        self.exp = exp
        self.env_data=env_data
       

    def act(self):
        # time.sleep(10)
        result = False

        result = self.simulate_act()
        if result:
            self.target_info.vul.append(self.exp.name)
        
        return result, self.target_info

    def simulate_act(self):
       
        if self.env_data["ip"] == self.target_ip:
            for vul in self.exp.vulnerability:
                if vul in self.env_data['vulnerability']:
                    return self.check_rank_prob(prob=self.exp.prob)
        return False
    
    def check_rank_prob(self,prob):
        rand_num = random.random()  
        if Action_Class.use_action_prob:
            return rand_num < prob 
        else:
            return True

